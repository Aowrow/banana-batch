# Banana Batch 使用教程

## 📖 项目介绍

Banana Batch 是一个基于 Google Gemini 2.5 Flash Image 和 Gemini 3 Pro Image 的批量图片生成工具。支持并行生成多张图片，提供直观的界面和丰富的自定义选项。

### 主要特性

- 🎨 **批量图片生成**：一次生成多张图片（最多 20 张）
- 🖼️ **图片上传**：支持拖拽上传图片作为上下文
- 🌓 **主题切换**：支持浅色/深色主题
- ⚙️ **灵活配置**：可调整批次大小、宽高比、分辨率等
- 💬 **对话历史**：支持多轮对话，图片会作为上下文传递
- 🎯 **图片选择**：可以选择喜欢的图片保留在上下文中

---

## 🚀 快速开始

### 前置要求

- **Node.js** 18+ 版本
- **npm** 或 **yarn** 或 **pnpm**
- **Gemini API Key**（从 [Google AI Studio](https://ai.google.dev/) 获取）

### 安装步骤

1. **克隆或下载项目**
   ```bash
   cd banana-batch
   ```

2. **安装依赖**
   ```bash
   npm install
   ```

3. **配置 API Key**
   
   创建 `.env.local` 文件（在项目根目录）：
   ```bash
   GEMINI_API_KEY=your_gemini_api_key_here
   ```
   
   > 💡 **提示**：将 `your_gemini_api_key_here` 替换为你的实际 API Key

4. **启动开发服务器**
   ```bash
   npm run dev
   ```

5. **访问应用**
   
   打开浏览器访问：`http://localhost:3000`

---

## 📝 基本使用

### 1. 配置 API Key

首次使用需要配置 Gemini API Key：

1. 点击右上角设置面板中的 **🔑 钥匙图标**
2. 在弹出的输入框中输入你的 Gemini API Key
3. 点击 **✓ 确认按钮** 保存

> ⚠️ **注意**：API Key 存储在浏览器本地存储中，不会上传到服务器。

### 2. 生成图片

#### 方法一：纯文本生成

1. 在输入框中输入图片描述（例如："一只可爱的小猫坐在窗台上"）
2. 点击右侧的 **发送按钮** 或按 **Enter** 键
3. 等待图片生成完成

#### 方法二：图片 + 文本生成

1. **上传图片**：
   - 将图片文件拖拽到输入区域
   - 拖拽时会显示高亮边框和提示信息
   - 松开鼠标后，图片会显示在输入框上方

2. **输入描述**（可选）：
   - 在输入框中输入文字描述
   - 例如："基于这张图片生成一个卡通版本"

3. **发送**：
   - 点击发送按钮或按 Enter 键
   - 上传的图片会作为上下文传递给 AI

### 3. 查看和管理图片

- **预览上传的图片**：上传后会在输入框上方显示缩略图
- **删除图片**：鼠标悬停在图片上，点击右上角的 **X** 按钮
- **查看生成的图片**：生成的图片会显示在对话中
- **选择图片**：点击生成的图片，可以将其标记为"已选择"，选中的图片会保留在对话上下文中

---

## 🎨 功能详解

### 图片上传功能

#### 拖拽上传

1. 从文件管理器或桌面拖拽图片文件到聊天输入区域
2. 拖拽时会显示：
   - 高亮边框（蓝色）
   - 覆盖层提示："拖放图片到这里"
3. 松开鼠标完成上传
4. 图片会显示在输入框上方的预览区域

#### 图片预览

- 上传的图片会以缩略图形式显示
- 支持多张图片同时上传
- 每张图片都可以单独删除

#### 注意事项

- ✅ 支持常见图片格式：JPG、PNG、GIF、WebP 等
- ✅ 图片不会自动发送，需要点击发送按钮
- ✅ 图片会作为上下文添加到对话中
- ⚠️ 非图片文件会被自动忽略

---

### 设置配置

在右上角的设置面板中可以调整以下选项：

#### 1. 批次大小（Batch Size）

- **范围**：1-20 张
- **说明**：一次生成多少张图片
- **建议**：
  - 快速测试：1-2 张
  - 正常使用：2-5 张
  - 批量生成：10-20 张

#### 2. 宽高比（Aspect Ratio）

可选选项：
- **Auto**：自动比例（默认 1:1）
- **1:1**：正方形
- **3:4**：竖版（适合人像）
- **4:3**：横版（适合风景）
- **9:16**：竖版长图（适合手机壁纸）
- **16:9**：横版长图（适合电脑壁纸）

#### 3. 分辨率（Resolution）

- **1K (Fast)**：快速模式，使用 Gemini 2.5 Flash Image
- **2K (Pro)**：高质量模式，使用 Gemini 3 Pro Image
- **4K (Pro)**：超高质量模式，使用 Gemini 3 Pro Image

> 💡 **提示**：分辨率越高，生成时间越长，但质量更好。

---

### 主题切换

#### 切换主题

1. 点击右上角设置面板中的 **🌙/☀️ 图标**
2. 在浅色和深色主题之间切换

#### 主题特点

- **深色主题**（默认）：
  - 深色背景，适合夜间使用
  - 减少眼部疲劳

- **浅色主题**：
  - 明亮背景，适合白天使用
  - 更清晰的视觉效果

> 💡 **提示**：主题偏好会自动保存，下次访问时会自动应用。

---

### 对话历史

#### 图片选择功能

1. **选择图片**：
   - 鼠标悬停在生成的图片上
   - 点击图片，会显示"Selected"标记
   - 选中的图片会保留在对话上下文中

2. **取消选择**：
   - 再次点击已选中的图片
   - 图片会取消选择状态

3. **上下文传递**：
   - 只有选中的图片会传递给后续的生成请求
   - 未选中的图片不会影响后续生成

#### 多轮对话

- 支持连续对话
- 每次生成的图片可以选择性保留
- 上下文会累积，让 AI 更好地理解你的需求

---

## ⌨️ 快捷键

- **Enter**：发送消息（如果输入框有内容）
- **Shift + Enter**：换行（在输入框中）

---

## 🎯 使用技巧

### 1. 优化提示词

- **具体描述**：越具体越好
  - ❌ "一只猫"
  - ✅ "一只橘色的短毛猫，坐在窗台上，阳光透过窗户洒在它身上"

- **添加风格**：
  - "卡通风格"
  - "写实风格"
  - "水彩画风格"
  - "赛博朋克风格"

- **指定细节**：
  - "高分辨率"
  - "细节丰富"
  - "柔和的光线"

### 2. 利用图片上下文

- **风格转换**：上传一张图片，要求转换为不同风格
- **细节修改**：上传图片，要求修改特定部分
- **组合创作**：上传多张图片，要求融合创作

### 3. 批量生成策略

- **小批次测试**：先用 1-2 张测试效果
- **调整参数**：根据效果调整宽高比和分辨率
- **批量生成**：确认满意后增加批次大小

### 4. 图片选择策略

- **及时选择**：看到满意的图片立即选择
- **避免重复**：相似图片只选择最好的一张
- **清理上下文**：定期取消不需要的图片选择

---

## ❓ 常见问题

### Q: 如何获取 Gemini API Key？

A: 
1. 访问 [Google AI Studio](https://ai.google.dev/)
2. 登录你的 Google 账号
3. 创建新的 API Key
4. 复制 API Key 并粘贴到应用设置中

### Q: 图片上传后没有反应？

A: 
- 检查文件格式是否为图片格式
- 确认文件大小不超过限制
- 尝试刷新页面重新上传

### Q: 生成的图片质量不满意？

A: 
- 尝试使用更高分辨率（2K 或 4K）
- 优化提示词，添加更多细节描述
- 调整宽高比设置

### Q: 如何停止正在生成的图片？

A: 
- 点击输入框右侧的 **停止按钮**（红色方块图标）
- 生成会立即停止

### Q: 图片选择后如何取消？

A: 
- 再次点击已选中的图片
- 图片会取消选择状态

### Q: 主题设置没有保存？

A: 
- 检查浏览器是否允许本地存储
- 清除浏览器缓存后重新设置
- 尝试使用不同的浏览器

### Q: 支持哪些图片格式？

A: 
- 支持常见图片格式：JPG、PNG、GIF、WebP、BMP 等
- 不支持视频文件或 PDF 文件

---

## 🔧 高级配置

### 环境变量

在 `.env.local` 文件中可以配置：

```bash
# Gemini API Key（必需）
GEMINI_API_KEY=your_api_key_here
```

### 构建生产版本

```bash
# 构建
npm run build

# 预览构建结果
npm run preview
```

### 部署

构建后的文件在 `dist/` 目录，可以部署到：
- Vercel
- Netlify
- GitHub Pages
- 任何静态文件服务器

---

## 📚 技术说明

### 使用的模型

- **Gemini 2.5 Flash Image**：用于 1K 分辨率（快速模式）
- **Gemini 3 Pro Image**：用于 2K/4K 分辨率（高质量模式）

### 并发控制

- 最大并发请求数：10
- 自动重试机制：失败自动重试最多 3 次
- 指数退避策略：重试间隔逐渐增加

### 数据存储

- **本地存储**：
  - API Key：`localStorage.user_gemini_api_key`
  - 主题设置：`localStorage.app_theme`
- **不存储**：
  - 对话历史（刷新页面会清空）
  - 上传的图片（仅用于当前会话）

---

## 🐛 故障排除

### 问题：页面显示空白

**解决方案**：
1. 检查浏览器控制台是否有错误
2. 确认 Node.js 版本 >= 18
3. 清除浏览器缓存
4. 重新安装依赖：`rm -rf node_modules && npm install`

### 问题：API Key 无效

**解决方案**：
1. 确认 API Key 格式正确
2. 检查 API Key 是否过期
3. 在 Google AI Studio 中重新生成 API Key
4. 确认 API Key 有足够的配额

### 问题：图片生成失败

**解决方案**：
1. 检查网络连接
2. 确认 API Key 有效
3. 尝试减少批次大小
4. 检查提示词是否包含敏感内容

### 问题：拖拽上传不工作

**解决方案**：
1. 确认浏览器支持拖拽功能
2. 尝试使用 Chrome 或 Firefox
3. 检查文件是否为图片格式
4. 刷新页面重试

---

## 📞 获取帮助

如果遇到问题：

1. 查看浏览器控制台的错误信息
2. 检查网络请求是否成功
3. 确认 API Key 配置正确
4. 查看本文档的常见问题部分

---

## 🎉 开始使用

现在你已经了解了所有功能，开始创作你的图片吧！

1. ✅ 配置 API Key
2. ✅ 选择你喜欢的主题
3. ✅ 调整设置参数
4. ✅ 输入提示词或上传图片
5. ✅ 点击发送，等待生成完成
6. ✅ 选择喜欢的图片，继续创作

祝你使用愉快！🎨

